#!/usr/bin/env python3
import os, sys

# Rebuild argv so -c FILE, -p PORT, -v brief become -cFILE -pPORT -vbrief
rebuilt = []
i = 1
argv = sys.argv
while i < len(argv):
    a = argv[i]
    if a in ("-c", "-p", "-v"):
        if i+1 >= len(argv):
            sys.stderr.write(f"{a} missing value\n")
            sys.exit(2)
        rebuilt.append(a + argv[i+1])
        i += 2
    else:
        rebuilt.append(a)
        i += 1

exe = os.path.join(os.path.dirname(__file__), "ds-server.real")
cmd = [exe] + rebuilt
print("[Wrapper] Exec:", " ".join(cmd), file=sys.stderr)
os.execv(exe, cmd)
