#!/bin/sh
set -eu

# Convert spaced flags (-c file → -cfile, -p 123 → -p123)
newargs=""
while [ $# -gt 0 ]; do
  case "$1" in
    -c)
      if [ $# -lt 2 ]; then
        echo "ERROR: missing argument for -c" >&2
        exit 2
      fi
      newargs="$newargs -c$2"
      shift 2
      ;;
    -p)
      if [ $# -lt 2 ]; then
        echo "ERROR: missing argument for -p" >&2
        exit 2
      fi
      newargs="$newargs -p$2"
      shift 2
      ;;
    *)
      newargs="$newargs $1"
      shift
      ;;
  esac
done

echo "[Wrapper] Executing: ./ds-server.real $newargs" >&2
exec "$(dirname "$0")/ds-server.real" $newargs
